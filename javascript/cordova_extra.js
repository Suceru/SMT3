"use strict";var exitAppFlag=!1,isBusy=!1,isAppUpdateAvailable=!1,isUpdateAvailable=!1,isUpdateDownloaded=!1,webVersion="1970.01.01-08.00.00",appVersion="0.0.0",fetchUpdateOptions={"config-file":"http://survivalcraft.cn/smt3/chcp.json"},$footer=$("footer.md-footer"),$updateFooter=$(".footer-Update"),$updateText=$(".footer-Update-innerText"),$updateButton=$(".footer-Update-button");function cordova_onload(){document.addEventListener("deviceready",onDeviceReady,!1)}function onDeviceReady(){document.addEventListener("menubutton",onMenuButtonDown,!1),document.addEventListener("searchbutton",onSearchButtonDown,!1),document.addEventListener("backbutton",onBackButtonDown,!1),$updateButton.on({click:function(t){isBusy?t.preventDefault():isAppUpdateAvailable?(isBusy=!0,window.open("https://www.pgyer.com/EXaZ","_blank")):isUpdateDownloaded?(isBusy=!0,$updateButton.text("替换中"),chcp.installUpdate(installationCallback)):isUpdateAvailable&&(isBusy=!0,$updateButton.text("离线中"),chcp.fetchUpdate(fetchUpdateCallback,fetchUpdateOptions))},hover:function(t){isBusy&&t.preventDefault()}}),isHomepage&&(chcp.getVersionInfo(getLocalVersion),chcp.isUpdateAvailableForInstallation(function(t,e){if(t)return checkAppUpdateAvailable(),checkUpdateAvailable(),void setTimeout(function(){isAppUpdateAvailable?($updateText.text("检测到新版本App"),$updateButton.text("下载!"),$updateFooter.show(),$footer.css("height","17.61rem")):isUpdateAvailable&&($updateText.text("检测到新版本导航"),$updateButton.text("离线!"),$updateFooter.show(),$footer.css("height","17.61rem"))},2e3);isUpdateDownloaded=!0,$updateText.text("已下载新版本导航"),$updateButton.text("替换!"),$updateFooter.show(),$footer.css("height","17.61rem"),chcp.installUpdate(installationCallback)}),isAndroidBrowser&&$("#qrcodeForAndroid").hide())}function onMenuButtonDown(){$mdOverlay.click()}function onSearchButtonDown(){$mdSearchOverlay.click()}function onBackButtonDown(){0<$mdOverlay.css("opacity")?$mdOverlay.click():0<$mdSearchOverlay.css("opacity")?$mdSearchOverlay.click():exitAppFlag?navigator.app.exitApp():(exitAppFlag=!0,window.plugins.toast.showShortBottom("再按一次退出"),setTimeout(function(){exitAppFlag=!1},2e3))}function getLocalVersion(t,e){webVersion=e.currentWebVersion,appVersion=e.appVersion}function fetchUpdateCallback(t,e){if(isBusy=!1,t)return console.log("Failed to load the update with error code: "+t.code),console.log(t.description),$updateText.text("离线新版本导航失败"),void $updateButton.text("重试!");isUpdateDownloaded=!0,$updateText.text("已离线新版本导航"),$updateButton.text("安装!")}function installationCallback(t){isBusy=!1,t?(console.log("Failed to install the update with error code: "+t.code),console.log(t.description),$updateText.text("替换新导航版本失败"),$updateButton.text("重试!")):($updateText.text("已替换新导航版本"),$updateButton.text("完成!"))}function checkUpdateAvailable(){$.getJSON("http://survivalcraft.cn/smt3/chcp.json",function(t){isUpdateAvailable=webVersion2Date(t.release)>webVersion2Date(webVersion)})}function checkAppUpdateAvailable(){$.ajax({url:"https://www.pgyer.com/apiv2/app/check",type:"post",data:{_api_key:"398cd0b3301dc547fb6fa44a2a9ca906",appKey:"e83e1c6af401203340f8f0267d754a81"},success:function(t){isAppUpdateAvailable=appVersion!==t.data.buildVersion}})}function webVersion2Date(t){var e=t.split("-"),o=e[0].split("."),a=e[1].split(".");return new Date(o[0],o[1],o[2],a[0],a[1],a[2],0)}window.onload=cordova_onload;